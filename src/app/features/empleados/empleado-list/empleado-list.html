<!-- Toolbar -->
<app-toolbar title="Empleados"></app-toolbar>

<div class="empleados-page">
  <h1>Empleados</h1>
  <p class="subtitle">
    Administración de personal, tipos de cobro y estado en el sistema.
  </p>

  <!-- Acciones de tabla -->
  <div class="table-actions" *ngIf="hasAnyFilter()">
    <button mat-stroked-button (click)="clearAllFilters()">
      <mat-icon>filter_alt_off</mat-icon>
      Limpiar filtros
    </button>
  </div>

  <div class="table-wrapper">
    <table
      mat-table
      [dataSource]="dataSource"
      class="mat-elevation-z4 empleados-table"
    >

      <!-- Nombre -->
      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef>
          <div class="th-flex">
            <span>Nombre</span>
            <app-column-filter
              label="Nombre"
              [value]="filters.nombre"
              (valueChange)="setFilter('nombre', $event)"
              (clear)="clearFilter('nombre')"
            />
          </div>
        </th>
        <td mat-cell *matCellDef="let e">{{ e.nombre }}</td>
      </ng-container>

      <!-- Apellido -->
      <ng-container matColumnDef="apellido">
        <th mat-header-cell *matHeaderCellDef>
          <div class="th-flex">
            <span>Apellido</span>
            <app-column-filter
              label="Apellido"
              [value]="filters.apellido"
              (valueChange)="setFilter('apellido', $event)"
              (clear)="clearFilter('apellido')"
            />
          </div>
        </th>
        <td mat-cell *matCellDef="let e">{{ e.apellido }}</td>
      </ng-container>

      <!-- Documento -->
      <ng-container matColumnDef="documentoNumero">
        <th mat-header-cell *matHeaderCellDef>
          <div class="th-flex">
            <span>Documento</span>
            <app-column-filter
              label="Documento"
              [value]="filters.documentoNumero"
              (valueChange)="setFilter('documentoNumero', $event)"
              (clear)="clearFilter('documentoNumero')"
            />
          </div>
        </th>
        <td mat-cell *matCellDef="let e">{{ e.documentoNumero }}</td>
      </ng-container>

      <!-- Teléfono -->
      <ng-container matColumnDef="telefono">
        <th mat-header-cell *matHeaderCellDef>
          <div class="th-flex">
            <span>Teléfono</span>
            <app-column-filter
              label="Teléfono"
              [value]="filters.telefono"
              (valueChange)="setFilter('telefono', $event)"
              (clear)="clearFilter('telefono')"
            />
          </div>
        </th>
        <td mat-cell *matCellDef="let e">
          {{ e.telefono || '-' }}
        </td>
      </ng-container>

      <!-- Cargo -->
      <ng-container matColumnDef="cargo">
        <th mat-header-cell *matHeaderCellDef>
          <div class="th-flex">
            <span>Cargo</span>
            <app-column-filter
              label="Cargo"
              [value]="filters.cargo"
              (valueChange)="setFilter('cargo', $event)"
              (clear)="clearFilter('cargo')"
            />
          </div>
        </th>
        <td mat-cell *matCellDef="let e">{{ e.cargo }}</td>
      </ng-container>

      <!-- Días de trabajo -->
      <ng-container matColumnDef="diasTrabajo">
        <th mat-header-cell *matHeaderCellDef>Días</th>
        <td mat-cell *matCellDef="let e">
          {{ e.diasTrabajo.join(', ') }}
        </td>
      </ng-container>

      <!-- Tipo de cobro -->
      <ng-container matColumnDef="tipoCobro">
        <th mat-header-cell *matHeaderCellDef>Tipo de cobro</th>
        <td mat-cell *matCellDef="let e">
          <span class="badge-tipo">
            {{ getTipoCobro(e) }}
          </span>
        </td>
      </ng-container>

      <!-- Estado -->
      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef>Estado</th>
        <td mat-cell *matCellDef="let e">
          <span
            class="estado"
            [class.activo]="e.activo"
            [class.deshabilitado]="!e.activo"
          >
            {{ e.activo ? 'Activo' : 'Deshabilitado' }}
          </span>
        </td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef class="acciones-header">
          Acciones
        </th>
        <td mat-cell *matCellDef="let e" class="acciones-cell">

    <button
      mat-icon-button
      matTooltip="Editar"
      [routerLink]="['/empleados', e.id, 'editar']"
    >
      <mat-icon>edit</mat-icon>
    </button>

          <button
            mat-icon-button
            [matTooltip]="e.activo ? 'Deshabilitar' : 'Habilitar'"
            (click)="toggleActivo(e)"
          >
            <mat-icon>
              {{ e.activo ? 'block' : 'check_circle' }}
            </mat-icon>
          </button>

          <button
            mat-icon-button
            color="warn"
            matTooltip="Eliminar"
            (click)="eliminar(e)"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Header / Rows -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

    </table>

    <!-- Sin datos -->
    <div class="sin-datos" *ngIf="dataSource.data.length === 0">
      No hay empleados cargados.
    </div>
  </div>
</div>
